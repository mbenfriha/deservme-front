<div class="container">
  <div class="row">
  <ng-container *ngIf="exist && quizz">
    <ng-container *ngIf="isConnected">
      <ng-container *ngIf="myQuizz">
        <div class="col s12 l4 user z-depth-3">
          <div class="title-page">{{quizz.title}}</div>
          <div class="col s2">
            <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}">
          </div>

          <div class="col s10">
            <p>
              - Ce quizz contient {{quizz.questions.length}} questions <br>
              - <span *ngIf="quizz?.answer_count < 1">Tu es le premier a participer à ce quizz</span>
              <span *ngIf="quizz?.answer_count == 1">1 personne a participé à ce quizz</span>
              <span *ngIf="quizz?.answer_count > 1">{{quizz.answer_count}} ont participés à ce quizz</span>
            </p>

            <share-buttons class="right" [theme]="'default'"
                           [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                           [show]="6"
                           [size]="4"
                           [url]="'https://myquizzy.com/quizz/'+ quizz._id"
                           [title]="'Mon quizz : '+ quizz.title"
                           [description]="'Essaye de répondre au mieux à mon quizz'"
                           [autoSetMeta]="false">

            </share-buttons>

          </div>
        </div>
        <div class="col s12 l8 right">
          <div class="title-page">Les bonnes réponses</div>
          <ul class="collection z-depth-3">
            <li class="collection-item" *ngFor="let q of quizz.questions">
              <span class="title">{{q.name}}: </span>
              <ng-container *ngFor="let a of q.choices">
                <span class="text-green" *ngIf="a.rep == true"> {{a.name}}</span>
              </ng-container>
            </li>
          </ul>
        </div>
        <div class="col s12">
          <app-answers-list [allAnswer]="allAnswer"></app-answers-list>
        </div>

      </ng-container>
      <ng-container *ngIf="!myQuizz">
        <ng-container *ngIf="!alreadyAnswer">
          <div class="col s12 l4 user z-depth-3">
            <div class="col s2">
              <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}">
            </div>

            <div class="col s10">
              <p>- Ce Quizz a été crée par {{quizz.username}} <br>
                - Ce quizz contient {{quizz.questions.length}} questions <br>
                - <span *ngIf="quizz?.answer_count < 1">Tu es le premier a participer à ce quizz</span>
                <span *ngIf="quizz?.answer_count == 1">1 personne a participé à ce quizz</span>
                <span *ngIf="quizz?.answer_count > 1">{{quizz.answer_count}} ont participés à ce quizz</span>
              </p>

              <share-buttons class="right" [theme]="'default'"
                             [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                             [show]="6"
                             [size]="4"
                             [url]="'https://myquizzy.com/quizz/'+ quizz._id"
                             [title]="'Mon quizz : '+ quizz.title"
                             [description]="'Essaye de répondre au mieux à mon quizz'"
                             [autoSetMeta]="false">

              </share-buttons>
            </div>
            <button class="btn purple-border right col s12" (click)="reportQuizz()" [disabled]="report">Signaler le quizz
            </button>

          </div>
          <div class="col s12 l8 offset-l1 answer-quizz">
            <div class="title-answer">{{quizz.title}}</div>
            <div class="row question z-depth-3" *ngIf="nbrQ == quizz.questions.length">
              <div class="col s12">
                <div class="title-question col s12 ">Rentre un pseudo </div>

                <input type="text" placeholder="Pseudo" maxlength="16" [(ngModel)]="username">
              </div>
            </div>
            <ng-container  *ngFor="let q of quizz.questions, let i = index;">
              <div class="row question z-depth-3" *ngIf="nbrQ == i" >
                <div class="title-question col s12 ">{{q.name}} </div>

                <div class="row answers" >
                  <h2>Choisis une réponse :</h2>
                  <p *ngFor="let choice of q.choices; let j = index">
                    <label>
                      <input name="group{{i}}" type="radio" (click)="setAnswer(choice, q)"  [checked]="answer?.questions[i]?.answer?.name == choice.name" />
                      <span>{{choice.name}}</span>
                    </label>
                  </p>
                </div>
              </div>
            </ng-container>
            <div class="row answer-end">
              <div class="col s12">
                <button (click)="previewQ()" class="white-button left btn" *ngIf="nbrQ > 0">Précédent</button>
                <button (click)="nextQ()" class="white-button right btn" *ngIf="nbrQ < quizz.questions.length - 1 ">Suivant</button>
                <button (click)="validateAnswer()" class="white-button right btn" *ngIf="nbrQ == quizz.questions.length - 1 ">Valider</button>
              </div>
            </div>

          </div>
          <div class="col s12">

            <app-answers-list [allAnswer]="allAnswer"></app-answers-list>
          </div>
        </ng-container>

        <ng-container *ngIf="alreadyAnswer">
          <div class="title-page">{{quizz.title}}</div>

          <div class="col s12  user z-depth-3">
            <div class="col s2">
              <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}" [routerLink]="['/profil/'+quizz.user_id]">
            </div>

            <div class="col s10">
              <p>- Ce Quizz a été crée par <a [routerLink]="['/profil/'+quizz.user_id]">{{quizz.username}}</a> <br>
                - Ce quizz contient {{answer.questions.length}} questions <br>
                - <span *ngIf="quizz?.answer_count < 1">Tu es le premier a participer à ce quizz</span>
                <span *ngIf="quizz?.answer_count == 1">1 personne a participé à ce quizz</span>
                <span *ngIf="quizz?.answer_count > 1">{{quizz.answer_count}} ont participés à ce quizz</span>
              </p>
              <share-buttons class="right" [theme]="'default'"
                             [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                             [show]="6"
                             [size]="4"
                             [url]="'https://myquizzy.com/quizz/'+ quizz._id"
                             [title]="'Mon quizz : '+ quizz.title"
                             [description]="'Essaye de répondre au mieux à mon quizz'"
                             [autoSetMeta]="false">

              </share-buttons>
            </div>

          </div>

          <div  class="already col s12">
            {{finalString}}<br>
            <span> {{result}} % </span>
          </div>

          <div class="col s12">
            <app-answers-list [allAnswer]="allAnswer"></app-answers-list>
          </div>
        </ng-container>
      </ng-container>

    </ng-container>
    <ng-container *ngIf="!isConnected">
      <ng-container *ngIf="!alreadyAnswer">
        <div class="col s12 l4 user z-depth-3">
          <div class="col s2">
            <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}" [routerLink]="['/profil/'+quizz.user_id]">
          </div>

          <div class="col s10">
            <p>- Ce Quizz a été crée par <a [routerLink]="['/profil/'+quizz.user_id]">{{quizz.username}}</a> <br>
              - Ce quizz contient {{quizz.questions.length}} questions <br>
              - <span *ngIf="quizz?.answer_count < 1">Tu es le premier a participer à ce quizz</span>
              <span *ngIf="quizz?.answer_count == 1">1 personne a participé à ce quizz</span>
              <span *ngIf="quizz?.answer_count > 1">{{quizz.answer_count}} ont participés à ce quizz</span>
            </p>

            <share-buttons class="right" [theme]="'default'"
                           [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                           [show]="6"
                           [size]="4"
                           [url]="'https://myquizzy.com/quizz/'+ quizz._id"
                           [title]="'Mon quizz : '+ quizz.title"
                           [description]="'Essaye de répondre au mieux à mon quizz'"
                           [autoSetMeta]="false">

            </share-buttons>

          </div>
        </div>
        <div class="col s12 l8 offset-l1 answer-quizz">
          <div class="title-answer">{{quizz.title}}</div>
          <div class="row question z-depth-3" *ngIf="nbrQ == quizz.questions.length">
            <div class="col s12">
              <div class="title-question col s12 ">Rentre un pseudo </div>

              <input type="text" placeholder="Pseudo" minlength="3" maxlength="16" [(ngModel)]="username">
            </div>
          </div>
          <ng-container  *ngFor="let q of quizz.questions, let i = index;">
            <div class="row question z-depth-3" *ngIf="nbrQ == i" >
              <div class="title-question col s12 ">{{q.name}} </div>

              <div class="row answers" >
                <h2>Choisis une réponse :</h2>
                <p *ngFor="let choice of q.choices; let j = index">
                  <label>
                    <input name="group{{i}}" type="radio" (click)="setAnswer(choice, q)"  [checked]="answer?.questions[i]?.answer?.name == choice.name" />
                    <span>{{choice.name}}</span>
                  </label>
                </p>
              </div>
            </div>
          </ng-container>
          <div class="row answer-end">
            <div class="col s12">
              <button (click)="previewQ()" class="white-button left btn" *ngIf="nbrQ > 0">Précédent</button>
              <button (click)="nextQ()" class="white-button right btn" *ngIf="nbrQ < quizz.questions.length">Suivant</button>
              <button (click)="validateAnswer()" class="white-button right btn" *ngIf="nbrQ == quizz.questions.length">Valider</button>
            </div>
          </div>

        </div>
        <div class="col s12">
          <app-answers-list [allAnswer]="allAnswer"></app-answers-list>
        </div>
      </ng-container>

      <ng-container *ngIf="alreadyAnswer">
        <div class="title-page">{{quizz.title}}</div>

        <div class="col s12  user z-depth-3">
          <div class="col s2">
            <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}" [routerLink]="['/profil/'+quizz.user_id]">
          </div>

          <div class="col s10">
            <p>- Ce Quizz a été crée par <a [routerLink]="['/profil/'+quizz.user_id]">{{quizz.username}} </a><br>
              - Ce quizz contient {{answer.questions.length}} questions <br>
              - <span *ngIf="quizz?.answer_count < 1">Tu es le premier a participer à ce quizz</span>
              <span *ngIf="quizz?.answer_count == 1">1 personne a participé à ce quizz</span>
              <span *ngIf="quizz?.answer_count > 1">{{quizz.answer_count}} ont participés à ce quizz</span>
            </p>
            <share-buttons class="right" [theme]="'default'"
                           [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                           [show]="6"
                           [size]="4"
                           [url]="'https://myquizzy.com/quizz/'+ quizz._id"
                           [title]="'Mon quizz : '+ quizz.title"
                           [description]="'Essaye de répondre au mieux à mon quizz'"
                           [autoSetMeta]="false">

            </share-buttons>
          </div>

        </div>

        <div  class="already col s12">
          {{finalString}}<br>
          <span> {{result}} % </span>
          <button class="btn green-button" (click)="openModal()">Inscris toi pour créer ton quizz</button>
        </div>

        <div class="col s12">
          <app-answers-list [allAnswer]="allAnswer"></app-answers-list>
        </div>
      </ng-container>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="!exist">
    <div class="empty" *ngIf="!exist">
      Ce quizz n'existe pas ou a été supprimé <br>
      <i class="material-icons">
        error_outline
      </i>
    </div>
  </ng-container>
  </div>
</div>

<app-modal-register (modalClose)="closeModal()" [modal]="modal"></app-modal-register>

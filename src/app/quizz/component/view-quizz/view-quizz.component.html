<div class="container">
    <div class="row">
        <ng-container *ngIf="exist && quizz">
            <ng-container *ngIf="isConnected">
                <ng-container *ngIf="myQuizz">
                    <div class="col s12 l4 user z-depth-3">
                        <div class="title-page">{{quizz.title}}</div>
                        <div class="col s2">
                            <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}">
                        </div>

                        <div class="col s10">
                            <p>
                                - <span>{{ "quizz.quizzare" | translate}} <span class="{{quizz.private ? 'red-text' : 'green-text'}}">{{ (quizz.private ? "quizz.private" : "quizz.public") | translate }}</span></span> <br>
                                - <span *ngIf="!quizz.close">{{ "quizz.open" | translate }} </span>
                                <span *ngIf="quizz.close">{{ "quizz.close" | translate }} </span><br>
                                - {{ "quizz.quizzcontain" | translate:({nbr:  quizz.questions.length}) }}<br>
                                - <span *ngIf="quizz?.answer_count < 1">{{ "quizz.firstanswer" | translate}}</span>
                                <span *ngIf="quizz?.answer_count == 1">{{ "quizz.oneanswer" | translate }}</span>
                                <span *ngIf="quizz?.answer_count > 1">{{ "quizz.answersplay" | translate:({nbr:  quizz.answer_count}) }}</span>
                            </p>
                        </div>
                        <div class="col s11 offset-s1">

                            <share-buttons class="right" [theme]="'default'"
                                           [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                                           [show]="6"
                                           [size]="4"
                                           [url]="shortUrl + 'q/' + quizz.shortUrl"
                                           [title]="'Mon quizz : '+ quizz.title"
                                           [description]="'Essaye de répondre au mieux à mon quizz'"
                                           [autoSetMeta]="false">

                            </share-buttons>
                        </div>
                        <div class="col s12">
                            <button class="purple-border col s12 btn" (click)="setState()">
                                {{(quizz.private ? "quizz.buttonprivate" : "quizz.buttonpublic") | translate }}
                            </button>
                            <button class="purple-border col s12 btn" (click)="setClose()">
                                {{(quizz.close ? "quizz.openquizz" : "quizz.closequizz") | translate }}
                            </button>
                            <button class="green-button col s12 btn" (click)="openModalDelete()">{{ "quizz.buttondelete" | translate}}</button>
                        </div>
                    </div>

                    <div class="col s12 l8">
                        <div class="row">
                            <div class="col s12">
                                <!--  <ul class="tabs">
                                    <li class="tab col s6"><a (click)="displayTab('top')" class="{{tab == 'top' ? 'active' : ''}}">Classement</a></li>
                                    <li class="tab col s6"><a (click)="displayTab('resp')" class="{{tab == 'resp' ? 'active' : ''}}">Réponses</a></li>
                                  </ul>-->

                                <materialize-tab-group>
                                      <materialize-tab title="{{'quizz.ranking' | translate}}">
                                    <div class="col s12 no-padding">
                                        <app-answers-list [allAnswer]="allAnswer" [myQuizz]="true"></app-answers-list>
                                    </div>
                                </materialize-tab>
                                      <materialize-tab title="{{'quizz.answers' | translate}}">

                                    <div class="col s12 right">
                                        <ul class="collection z-depth-3">
                                            <li class="collection-item" *ngFor="let q of quizz.questions">
                                                <b class="title">{{q.name}} : </b>
                                                <ng-container *ngFor="let a of q.choices">
                                                    <span class="text-green" *ngIf="a.rep == true"> {{a.name}}</span>
                                                </ng-container>
                                            </li>
                                        </ul>
                                    </div>

                                </materialize-tab>
                                </materialize-tab-group>
                            </div>
                        </div>

                    </div>

                </ng-container>
                <ng-container *ngIf="!myQuizz">
                    <ng-container *ngIf="!alreadyAnswer">
                        <div class="col s12 l4 user z-depth-3">
                            <div class="col s2">
                                <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}" [routerLink]="['/profile/'+quizz.user_id]">
                            </div>

                            <div class="col s10">
                                <p> - {{"quizz.author" | translate}} <a [routerLink]="['/profile/'+quizz.user_id]">{{quizz.username}}</a> <br>
                                    - <span>{{ "quizz.quizzare" | translate}} <span class="{{quizz.private ? 'red-text' : 'green-text'}}">{{ (quizz.private ? "quizz.private" : "quizz.public") | translate }}</span></span> <br>
                                    - <span *ngIf="!quizz.close">{{ "quizz.open" | translate }} </span>
                                    <span *ngIf="quizz.close">{{ "quizz.close" | translate }} </span><br>
                                    - {{ "quizz.quizzcontain" | translate:({nbr:  quizz.questions.length}) }}<br>
                                    - <span *ngIf="quizz?.answer_count < 1">{{ "quizz.firstanswer" | translate}}</span>
                                    <span *ngIf="quizz?.answer_count == 1">{{ "quizz.oneanswer" | translate }}</span>
                                    <span *ngIf="quizz?.answer_count > 1">{{ "quizz.answersplay" | translate:({nbr:  quizz.answer_count}) }}</span>
                                </p>
                            </div>

                            <div class="col s11 offset-s1">
                                <share-buttons class="right" [theme]="'default'"
                                               [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                                               [show]="6"
                                               [size]="4"
                                               [url]="shortUrl + 'q/' + quizz.shortUrl"
                                               [title]="'Mon quizz : '+ quizz.title"
                                               [description]="'Essaye de répondre au mieux à mon quizz'"
                                               [autoSetMeta]="false">

                                </share-buttons>

                            </div>

                            <button class="btn purple-border right col s12" (click)="sendReport()" [disabled]="report">
                                {{"quizz.buttonreport" | translate }}
                            </button>

                        </div>
                        <div class="col s12 l8 offset-l1 answer-quizz">
                            <div class="title-answer">{{quizz.title}}</div>
                            <div class="row question z-depth-3" *ngIf="nbrQ == quizz.questions.length">
                                <div class="col s12">
                                    <div class="title-question col s12 ">{{"quizz.enterusername"| translate}} </div>

                                    <input type="text" placeholder="Pseudo" maxlength="16" [(ngModel)]="username">
                                </div>
                            </div>
                            <ng-container  *ngFor="let q of quizz.questions, let i = index;">
                                <div class="row question z-depth-3" *ngIf="nbrQ == i" >
                                    <div class="title-question col s12 ">{{q.name}} </div>

                                    <div class="row answers" >
                                        <h2 class="choice-answer">{{"quizz.choiceanswer" | translate}} :</h2>
                                        <p *ngFor="let choice of q.choices; let j = index">
                                            <label>
                                                <input name="group{{i}}" type="radio" (click)="setAnswer(choice, q)"  [checked]="answer?.questions[i]?.answer?.name == choice.name" />
                                                <span>{{choice.name}}</span>
                                            </label>
                                        </p>
                                    </div>
                                </div>
                            </ng-container>
                            <div class="row answer-end">
                                <div class="col s12">
                                    <button (click)="previewQ()" class="white-button left btn" *ngIf="nbrQ > 0">{{ "quizz.previous" | translate}}</button>
                                    <button (click)="nextQ()" class="white-button right btn" *ngIf="nbrQ < quizz.questions.length - 1 ">{{ "quizz.next" | translate}}</button>
                                    <button (click)="validateAnswer()" class="white-button right btn" *ngIf="nbrQ == quizz.questions.length - 1 ">{{ "quizz.validate" | translate}}</button>
                                </div>
                            </div>

                        </div>
                        <div class="col s12 no-padding">

                            <app-answers-list [allAnswer]="allAnswer"></app-answers-list>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="alreadyAnswer">
                        <div class="title-page">{{quizz.title}}</div>

                        <div class="col s12  user z-depth-3">
                            <div class="col s2">
                                <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}" [routerLink]="['/profile/'+quizz.user_id]">
                            </div>

                            <div class="col s10">
                                <p> - {{"quizz.author" | translate}} <a [routerLink]="['/profile/'+quizz.user_id]">{{quizz.username}}</a> <br>
                                    - <span>{{ "quizz.quizzare" | translate}} <span class="{{quizz.private ? 'red-text' : 'green-text'}}">{{ (quizz.private ? "quizz.private" : "quizz.public") | translate }}</span></span> <br>
                                    - <span *ngIf="!quizz.close">{{ "quizz.open" | translate }} </span>
                                    <span *ngIf="quizz.close">{{ "quizz.close" | translate }} </span><br>
                                    - {{ "quizz.quizzcontain" | translate:({nbr:  quizz.questions.length}) }}<br>
                                    - <span *ngIf="quizz?.answer_count < 1">{{ "quizz.firstanswer" | translate}}</span>
                                    <span *ngIf="quizz?.answer_count == 1">{{ "quizz.oneanswer" | translate }}</span>
                                    <span *ngIf="quizz?.answer_count > 1">{{ "quizz.answersplay" | translate:({nbr:  quizz.answer_count}) }}</span>
                                </p>
                                <share-buttons class="right" [theme]="'default'"
                                               [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                                               [show]="6"
                                               [size]="4"
                                               [url]="shortUrl+ 'q/' + quizz.shortUrl"
                                               [title]="'Mon quizz : '+ quizz.title"
                                               [description]="'Essaye de répondre au mieux à mon quizz'"
                                               [autoSetMeta]="false">

                                </share-buttons>
                            </div>

                            <button class="btn purple-border right col s12" (click)="sendReport()" [disabled]="report">
                                {{"quizz.buttonreport" | translate}}
                            </button>
                        </div>

                        <div  class="already col s12">
                            {{finalString | translate}}<br>
                            <span> {{result}} % </span>
                        </div>

                        <div class="col s12 no-padding">
                            <app-answers-list [allAnswer]="allAnswer"></app-answers-list>
                        </div>
                    </ng-container>
                </ng-container>

            </ng-container>
            <ng-container *ngIf="!isConnected">
                <ng-container *ngIf="!alreadyAnswer">
                    <div class="col s12 l4 user z-depth-3">
                        <div class="col s2">
                            <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}" [routerLink]="['/profile/'+quizz.user_id]">
                        </div>

                        <div class="col s10">
                            <p> - {{"quizz.author" | translate}} <a [routerLink]="['/profile/'+quizz.user_id]">{{quizz.username}}</a> <br>
                                - <span>{{ "quizz.quizzare" | translate}} <span class="{{quizz.private ? 'red-text' : 'green-text'}}">{{ (quizz.private ? "quizz.private" : "quizz.public") | translate }}</span></span> <br>
                                - <span *ngIf="!quizz.close">{{ "quizz.open" | translate }} </span>
                                <span *ngIf="quizz.close">{{ "quizz.close" | translate }} </span><br>
                                - {{ "quizz.quizzcontain" | translate:({nbr:  quizz.questions.length}) }}<br>
                                - <span *ngIf="quizz?.answer_count < 1">{{ "quizz.firstanswer" | translate}}</span>
                                <span *ngIf="quizz?.answer_count == 1">{{ "quizz.oneanswer" | translate }}</span>
                                <span *ngIf="quizz?.answer_count > 1">{{ "quizz.answersplay" | translate:({nbr:  quizz.answer_count}) }}</span>
                            </p>

                            <share-buttons class="right" [theme]="'default'"
                                           [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                                           [show]="6"
                                           [size]="4"
                                           [url]="shortUrl + 'q/' + quizz.shortUrl"
                                           [title]="'Mon quizz : '+ quizz.title"
                                           [description]="'Essaye de répondre au mieux à mon quizz'"
                                           [autoSetMeta]="false">

                            </share-buttons>

                        </div>
                        <button class="btn purple-border right col s12" (click)="sendReport()" [disabled]="report">
                            {{"quizz.buttonreport" | translate}}
                        </button>
                        <button class="btn green-button right col s12" (click)="openModal()">{{"home.register" | translate}} / {{"home.connection" | translate}}</button>
                    </div>
                    <div class="col s12 l8 offset-l1 answer-quizz">
                        <div class="title-answer">{{quizz.title}}</div>
                        <div class="row question z-depth-3" *ngIf="nbrQ == quizz.questions.length">
                            <div class="col s12">
                                <div class="title-question col s12 ">{{"quizz.enterusername" | translate}}</div>

                                <input type="text" placeholder="Pseudo" minlength="3" maxlength="16" [(ngModel)]="username">
                            </div>
                        </div>
                        <ng-container  *ngFor="let q of quizz.questions, let i = index;">
                            <div class="row question z-depth-3" *ngIf="nbrQ == i" >
                                <div class="title-question col s12 ">{{q.name}} </div>

                                <div class="row answers" >
                                    <h2>{{"quizz.choiceanswer" | translate}} :</h2>
                                    <p *ngFor="let choice of q.choices; let j = index">
                                        <label>
                                            <input [disabled]="quizz.close" name="group{{i}}" type="radio" (click)="setAnswer(choice, q)"  [checked]="answer?.questions[i]?.answer?.name == choice.name" />
                                            <span>{{choice.name}}</span>
                                        </label>
                                    </p>
                                </div>
                            </div>
                        </ng-container>
                        <div class="row answer-end">
                            <div class="col s12">
                                <button (click)="previewQ()" class="white-button left btn" *ngIf="nbrQ > 0">{{"quizz.previous" | translate}}</button>
                                <button (click)="openModal()" class="white-button left btn col s12" *ngIf="quizz.close">{{"quizz.needconnection" | translate}}</button>
                                <button (click)="nextQ()" class="white-button right btn" *ngIf="nbrQ < quizz.questions.length && !quizz.close" [disabled]="quizz.close">{{"quizz.next" | translate}}</button>
                                <button (click)="validateAnswerAnony()" class="white-button right btn" *ngIf="nbrQ == quizz.questions.length">{{"quizz.validate" | translate}}</button>
                            </div>
                        </div>

                    </div>
                    <div class="col s12 l8 offset-l1 no-padding">
                        <app-answers-list [allAnswer]="allAnswer"></app-answers-list>
                    </div>
                </ng-container>
                <ng-container *ngIf="alreadyAnswer">
                    <div class="title-page">{{quizz.title}}</div>

                    <div class="col s12  user z-depth-3">
                        <div class="col s2">
                            <img class="circle" src="{{getAvatar(quizz.user_id)}}" alt="img {{quizz.username}}" [routerLink]="['/profile/'+quizz.user_id]">
                        </div>

                        <div class="col s10">
                            <p> - {{"quizz.author" | translate}} <a [routerLink]="['/profile/'+quizz.user_id]">{{quizz.username}}</a> <br>
                                - <span>{{ "quizz.quizzare" | translate}} <span class="{{quizz.private ? 'red-text' : 'green-text'}}">{{ (quizz.private ? "quizz.private" : "quizz.public") | translate }}</span></span> <br>
                                - <span *ngIf="!quizz.close">{{ "quizz.open" | translate }} </span>
                                <span *ngIf="quizz.close">{{ "quizz.close" | translate }} </span><br>
                                - {{ "quizz.quizzcontain" | translate:({nbr:  quizz.questions.length}) }}<br>
                                - <span *ngIf="quizz?.answer_count < 1">{{ "quizz.firstanswer" | translate}}</span>
                                <span *ngIf="quizz?.answer_count == 1">{{ "quizz.oneanswer" | translate }}</span>
                                <span *ngIf="quizz?.answer_count > 1">{{ "quizz.answersplay" | translate:({nbr:  quizz.answer_count}) }}</span>
                            </p>
                            <share-buttons class="right" [theme]="'default'"
                                           [include]="['facebook','twitter','messenger','whatsapp','sms', 'copy']"
                                           [show]="6"
                                           [size]="4"
                                           [url]="shortUrl + 'q/' + quizz.shortUrl"
                                           [title]="'Mon quizz : '+ quizz.title"
                                           [description]="'Essaye de répondre au mieux à mon quizz'"
                                           [autoSetMeta]="false">

                            </share-buttons>
                        </div>
                        <button class="btn purple-border right col s12" (click)="sendReport()" [disabled]="report">
                            {{"quizz.buttonreport" | translate}}
                        </button>

                    </div>

                    <div  class="already col s12">
                        <button class="btn green-button col s12" (click)="openModal()">{{"quizz.proposeregister" | translate}}</button>

                        {{finalString | translate}}<br>
                        <span> {{result}} % </span>
                    </div>

                    <div class="col s12 no-padding">
                        <app-answers-list [allAnswer]="allAnswer"></app-answers-list>
                    </div>
                </ng-container>
            </ng-container>
        </ng-container>

        <ng-container *ngIf="!exist">
            <div class="empty" *ngIf="!exist">
                {{ 'quizz.noexist' | translate }} <br>
                <i class="material-icons">
                    error_outline
                </i>
            </div>
        </ng-container>
    </div>
</div>

<app-modal-register (modalClose)="closeModal()" [modal]="modal"></app-modal-register>

<div class="overlay" (click)="closeModalDelete()" *ngIf="modalDelete"></div>

<div class="modal-connexion modal" *ngIf="modalDelete">
    <div class="modal-content row">
        <h4>Est-tu sûr de vouloir supprimer ton quizz ?</h4>

        <div class="col s12">
            <button class="btn col s5 waves-effect waves-light green" (click)="deleteQuizz()">Oui</button>
            <button class="btn col s5 offset-s2 waves-effect waves-light red" (click)="closeModalDelete()">Annuler</button>
        </div>
    </div>
</div>
